# ============================================
# Render.com Infrastructure as Code
# Documentation: https://render.com/docs/blueprint-spec
# ============================================

services:
  # PostgreSQL Database
  - type: pserv
    name: budgetapp-db
    plan: free
    # Free tier: 1 GB storage, 90 days retention
    # Database auto-sleeps after inactivity

  # Web Service (Docker)
  - type: web
    name: budgetapp
    env: docker
    plan: free
    # Free tier: 512 MB RAM, shared CPU
    # Auto-sleeps after 15 minutes of inactivity
    # Wakes up on first request (~30 seconds)
    
    # Build configuration
    dockerfilePath: ./Dockerfile
    dockerContext: ./
    
    # Health check endpoint
    healthCheckPath: /healthcheck
    
    # Environment variables
    envVars:
      - key: DB_DRIVER
        value: org.postgresql.Driver
      
      - key: DB_DIALECT
        value: org.hibernate.dialect.PostgreSQL95Dialect
      
      - key: DB_URL
        fromDatabase:
          name: budgetapp-db
          property: connectionString
      
      - key: DB_USERNAME
        fromDatabase:
          name: budgetapp-db
          property: user
      
      - key: DB_PASSWORD
        fromDatabase:
          name: budgetapp-db
          property: password
      
      - key: DB_VALIDATE_QUERY
        value: SELECT 1
      
      - key: JAVA_OPTS
        value: -Xmx400m -Xms200m
        # Reduced for free tier (512 MB total)
    
    # Auto-deploy on git push
    autoDeploy: true
